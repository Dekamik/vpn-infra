- become: yes
  hosts: all
  name: ovpn-install
  tasks:

    - name: Update apt packages
      apt:
        update_cache: yes

    - name: Download openvpn-install.sh
      get_url:
        url: https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh
        dest: /opt/openvpn-install.sh
        mode: 0700

    - name: Run openvpn-install.sh
      shell: /opt/openvpn-install.sh
      environment:
        AUTO_INSTALL: y
        CLIENT: "{{ lookup('env', 'SERVER_NAME') }}"
    
    - name: Download ovpn config
      fetch:
        src: ~/client.ovpn
        dest: ~/SynologyDrive/Private/Auth/vpn/
